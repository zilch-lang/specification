\namespace{nstar:rules}{
\newcommand*\CodeTypeSequent[7]{\ensuremath{{#1};{#2};{#3};{#4};{#5}\vdash^\text{\tiny T}_\text{code}{#6:#7}}}
\newcommand*\DataTypeSequent[3]{\ensuremath{{#1}\vdash^\text{\tiny T}_\text{data}{#2:#3}}}
\newcommand*\KindSequent[3]{\ensuremath{{#1}\vdash^\text{\tiny K}{#2\ifx&#3&\else:#3\fi}}}
\newcommand*\ISequent[9]{\ensuremath{{#1};{#2};{#3};{#4};{#5}\vdash^\text{\tiny I}{#6}\dashv{#7};{#8};{#9}}}
}{}

\namespace{nstar:grammar}{
%% TYPES
\def\Tformat#1{\color{OliveGreen}\relax\ifmmode\bm{#1}\else\textbf{#1}\fi}
%
\newcommand*\Tunsigned[1]{\ensuremath{\text{\Tformat{u#1}}}}
\newcommand*\Tsigned[1]{\ensuremath{\text{\Tformat{s#1}}}}
\VARIADIC{Tstruct}{\ensuremath}{(}{,\,}{)}{}
\VARIADIC{Tunion}{\ensuremath}{\langle}{,\,}{\rangle}{}
\newcommand*\Tbang{\ensuremath{\text{\Tformat !}}}
\newcommand*\Tptr[1]{\ensuremath{{\Tformat{{}^\ast}}#1}}
\newcommand*\Tchar{\ensuremath{\text{\Tformat{char}}}}
\newcommand*\Tcontext[3]{\ensuremath{\{ #1 \mid #2 \to #3 \}}}
\newcommand*\Tforall[2]{\ensuremath{{\Tformat \forall}(#1){\Tformat .}\,{#2}}}
\newcommand*\Tstack[2]{\ensuremath{#1\,{\Tformat \dblcolon}\,#2}}
\VARIADIC{Tsstack}{\ensuremath}{}{\,{\Tformat \dblcolon}\,}{}{}
\newcommand*\Tkind[1]{\ensuremath{\text{\Tformat{T#1}}}}

\def\Ts{\T{s}}
\def\Ta{\T{a}}
\def\Tc{\T{c}}
\let\T\Tkind

%% EXPRESSIONS
\newcommand*\Echar[1]{\ensuremath{\text{'#1'}}}
\newcommand*\EInt[2][]{\ensuremath{#1#2}}
\newcommand*\Eregister[1]{\ensuremath{\text{\bfseries \%r#1}}}
\newcommand*\Ebyteoff[2]{\ensuremath{#1(#2)}}
\newcommand*\Ebaseoff[2]{\ensuremath{#1 [#2]}}
\VARIADIC{Earray}{\ensuremath}{[}{,\,}{]}{}
\newcommand*\Estring[1]{\ensuremath{\text{"#1"}}}
\VARIADIC{Estruct}{\ensuremath}{(}{,\,}{)}{}

\let\r\Eregister

%% INSTRUCTIONS
\definecolor{kw}{HTML}{5B269A}
\def\Iformat{\ttfamily\color{kw}}
%
\newcommand*\definstr[2][0]{%
	\ifnum#1=0%
		\expandafter\newcommand\csname I#2\endcsname{\ensuremath{\text{\Iformat #2}}}
	\else%
		\expandafter\VARIADIC{I#2}{\ensuremath}{\text{\Iformat #2}\ }{,\,}{}{}
	\fi%
}
%
\definstr{nop}
\definstr[1]{jmp}
\definstr[1]{call}
\definstr{ret}
\definstr{halt}
\definstr[2]{sld}
\definstr[2]{sst}
\definstr[1]{salloc}
\definstr{sfree}
\definstr[1]{sref}
\definstr[2]{ld}
\definstr[2]{st}
\definstr[2]{mv}
\definstr[3]{cjZ}
\definstr[3]{cjz}
\definstr[3]{cjnz}
\definstr[4]{cjC}
\definstr[4]{cje}
\definstr[4]{cjne}
\definstr[4]{cjl}
\definstr[4]{cjle}
\definstr[4]{cjg}
\definstr[4]{cjge}
\definstr[3]{and}
\definstr[3]{or}
\definstr[3]{xor}
\definstr[2]{not}
\definstr[3]{shiftl}
\definstr[3]{shiftr}
\definstr[3]{shiftX}
\definstr[4]{cmvZ}
\definstr[5]{cmvC}
\definstr[4]{cmvz}
\definstr[4]{cmvnz}
\definstr[5]{cmve}
\definstr[5]{cmvne}
\definstr[5]{cmvl}
\definstr[5]{cmvle}
\definstr[5]{cmvg}
\definstr[5]{cmvge}
\definstr[3]{div}
\definstr[3]{add}
\definstr[3]{sub}
\definstr[3]{mul}

% Add more instructions here, not below

\let\definstr\undefined
}{}

\namespace{nsam}{
	\definecolor{kw2}{HTML}{A90D91}
	\def\Ifmt{\ttfamily\bfseries\color{kw2}}

	\newcommand*\definstr[2][0]{%
		\ifnum#1=0%
			\expandafter\newcommand\csname In#2\endcsname{\ensuremath{\text{\Ifmt #2}}}
		\else%
			\expandafter\VARIADIC{In#2}{}{\text{\Ifmt #2}\ }{\ }{}{}
		\fi%
	}

	\definstr[1]{jmp}
	\definstr[1]{salloc}
	\definstr[1]{sfree}
	\definstr{halt}
	\definstr[2]{mv}
	\definstr[3]{sld}
	\definstr[2]{sst}
	\definstr[4]{ld}
	\definstr[3]{st}
	\definstr[3]{sref}
	\definstr[4]{cjmp}
	\definstr[6]{cmv}
	\definstr[4]{log2}
	\definstr[4]{arith2}
	\definstr[2]{not}

	%% ENVS

	\def\Efmt{\color{MidnightBlue}}

	\newcommand*\Enstack[3]{\ensuremath{{#1}^{#2}\,{\Efmt \dblcolon}\,#3}}
	\newcommand*\Enaddrof[1]{\ensuremath{{\Efmt {}^\&}#1}}
	\newcommand*\Enindex[2]{\ensuremath{{#1}\left[{#2}\right]}}
	\newcommand*\Enderef[1]{\ensuremath{{\Efmt {}^\ast}#1}}
	\newcommand*\Enset[2]{\ensuremath{{#1}\coloneqq{#2}}}

	\def\HC{H^\text{\tiny C}}
	\def\HD{H^\text{\tiny D}}

	%% Notations

	\newcommand*\Enstate[3]{\ensuremath{\left({#1},{#2},{#3}\right)}}
	\newcommand*\Enconfig[4]{\ensuremath{\left\langle{#1},\Enstate{#2}{#3}{#4}\right\rangle}}
}{}
